---
import { Calendar } from "@lucide/astro"
import { getTypeIcon, getTypeColor } from "./helpers"
import type { TimelineItemProps } from "./types"

const { exp, index } = Astro.props as TimelineItemProps

const Icon = exp.icon
const TypeIcon = getTypeIcon(exp.type)
const color = getTypeColor(exp.type)
---

<div
	class={`relative flex items-center ${
		index % 2 === 0 ? "md:flex-row" : "md:flex-row-reverse"
	} flex-col md:flex-row`}
>
	<div
		class={`timeline-card w-full md:w-5/12 ${
			index % 2 === 0 ? "md:pr-2 ml-0 md:ml-0" : "md:pl-2 ml-0 md:ml-0"
		}`}
	>
		<div
			class="bg-neutral-700 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2"
		>
			{/* Header */}
			<div class="flex items-start justify-between mb-4">
				<div class="flex items-center space-x-3">
					<div class={`p-2 ${exp.color} rounded-lg text-white`}>
						<Icon class="h-6 w-6" />
					</div>
					<div>
						<h3 class="text-lg font-bold text-white">
							{exp.position}
						</h3>
						<p class="text-blue-400 font-semibold">{exp.company}</p>
					</div>
				</div>
				<span
					class={`px-3 py-1 rounded-full text-xs font-medium flex items-center space-x-1 ${color}`}
				>
					<TypeIcon class="h-4 w-4" />
					<span>{exp.type}</span>
				</span>
			</div>

			{/* Period and Location */}
			<div class="flex flex-wrap items-center gap-4 mb-4 text-sm text-gray-300">
				<div class="flex items-center space-x-1">
					<Calendar class="h-4 w-4" />
					<span>{exp.period}</span>
				</div>
			</div>

			{/* Description */}
			<p class="text-gray-300 mb-4 leading-relaxed">{exp.description}</p>

			{/* Achievements */}
			<div class="mb-4">
				<h4 class="text-sm font-semibold text-white mb-2">Logros principales:</h4>
				<ul class="space-y-1">
					{
						exp.achievements.map(achievement => (
							<li class="text-sm text-gray-300 flex items-start">
								<span class="w-1.5 h-1.5 bg-blue-400 rounded-full mt-2 mr-2 shrink-0" />
								{achievement}
							</li>
						))
					}
				</ul>
			</div>

			{/* Technologies */}
			<div class="flex flex-wrap gap-2">
				{
					exp.technologies.map(tech => (
						<span class="px-3 py-1 bg-neutral-600 text-gray-200 rounded-full text-xs font-medium">
							{tech}
						</span>
					))
				}
			</div>
		</div>
	</div>
	<div
		class="absolute left-4 top-2 md:left-1/2 transform -translate-x-1/2 w-4 h-4 bg-neutral-700 md:bg-neutral-600 rounded-full border-4 border-neutral-700 md:border-neutral-800 z-10 transition-all duration-300 flex items-center justify-center timeline-dot"
	>
		<div class={`w-full h-full ${exp.color} rounded-full flex items-center justify-center`}>
			<div
				class="bg-neutral-700 md:bg-neutral-800 rounded-full transition-all duration-300 internal-dot"
			>
			</div>
		</div>
	</div>
	<div class="hidden md:block w-2/12 h-3"></div>
</div>

<style is:inline>
	.timeline-card:hover ~ .timeline-dot {
		width: 1.6rem;
		height: 1.6rem;
		left: calc(var(--spacing) * 6);
	}

	.internal-dot {
		transition: all 0.3s ease;
	}

	.timeline-card:hover ~ .timeline-dot .internal-dot {
		width: calc(2 / 3 * 100%);
		height: calc(2 / 3 * 100%);
	}
</style>
