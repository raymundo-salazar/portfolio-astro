---
import { ChevronDown, ChevronUp } from "@lucide/astro"
import { SHUFFLED_SKILLS, SKILL_CATEGORIES } from "./constants"

import SkillsCard from "@/components/molecules/SkillsCard/index.astro"
---

<section
	class="py-20 bg-neutral-900 relative transition-all duration-300 overflow-hidden"
	id="skills"
>
	<div class="text-center mb-16">
		<h2 class="text-3xl sm:text-4xl font-bold text-white mb-4">Habilidades Técnicas</h2>
		<div class="w-24 h-1 bg-blue-600 mx-auto rounded-full mb-6"></div>
		<p class="text-lg text-gray-300 max-w-2xl mx-auto">
			Tecnologías y herramientas que domino para crear soluciones completas
		</p>
	</div>
	<div class="flex justify-center gap-4 mb-10 flex-wrap px-4">
		{
			Object.entries(SKILL_CATEGORIES).map(([key, category]) => {
				const CategoryIcon = category.icon
				return (
					<div
						data-category={key}
						class={`rounded-full py-2 px-3 text-center text-xs font-semibold text-white ${category.color} cursor-pointer opacity-70 hover:opacity-100 transition-all duration-300 category-pill`}
					>
						<CategoryIcon class="w-4 h-4 inline-block mr-1" />
						{category.title}
					</div>
				)
			})
		}
	</div>
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 columns-2 md:columns-4 gap-4 space-y-4">
		{
			SHUFFLED_SKILLS.map(skill => {
				const category = SKILL_CATEGORIES[skill.category]
				return (
					<SkillsCard
						name={skill.name}
						icon={skill.icon}
						category={skill.category}
						categoryName={category.title}
						iconCategory={category.icon}
						categoryColor={category.color}
						iconColor={category.skilIconColor}
						size={skill.size}
					/>
				)
			})
		}
	</div>
	<div
		class="w-full p-5 absolute bottom-0 left-0 flex item-center justify-center gap-3 text-white from-white/20 to-white/0 bg-linear-to-t cursor-pointer hover:from-white/30 transition-all duration-300"
		id="toggle-skills"
	>
		<ChevronUp class="w-6 h-6 hidden" />
		<ChevronDown class="w-6 h-6" />
		<span>Mostrar más</span>
		<ChevronUp class="w-6 h-6 hidden" />
		<ChevronDown class="w-6 h-6" />
	</div>
</section>

<script is:inline>
	document.addEventListener("DOMContentLoaded", () => {
		const pills = document.querySelectorAll(".category-pill")
		const cards = document.querySelectorAll(".skill-card")
		let activeCategory = null

		pills.forEach(pill => {
			pill.addEventListener("click", () => {
				const category = pill.dataset.category

				if (activeCategory === category) {
					// Si haces clic en la misma categoría, se desactiva el filtro
					activeCategory = null
					pills.forEach(p => p.classList.remove("ring-2", "ring-white", "opacity-100"))
					cards.forEach(card => (card.style.display = ""))
				} else {
					// Activar nueva categoría
					activeCategory = category
					pills.forEach(p => {
						if (p.dataset.category === category) {
							p.classList.add("ring-2", "ring-white", "opacity-100")
						} else {
							p.classList.remove("ring-2", "ring-white")
							p.classList.add("opacity-40")
						}
					})

					cards.forEach(card => {
						card.style.display = card.dataset.category === category ? "" : "none"
					})
				}
			})
		})

		const container = document.getElementById("skills")
		const toggleBtn = document.getElementById("toggle-skills")
		const chevronUp = toggleBtn.querySelectorAll(".lucide-chevron-up")
		const chevronDown = toggleBtn.querySelectorAll(".lucide-chevron-down")
		const maxHeight = container.scrollHeight > 800 ? "800px" : container.scrollHeight + "px"
		let expanded = false

		container.style.maxHeight = maxHeight

		toggleBtn.addEventListener("click", () => {
			expanded = !expanded

			if (expanded) {
				container.style.maxHeight = container.scrollHeight + "px"
				toggleBtn.querySelector("span").textContent = "Mostrar menos"
				chevronUp.forEach(chevron => chevron.classList.remove("hidden"))
				chevronDown.forEach(chevron => chevron.classList.add("hidden"))
			} else {
				container.style.maxHeight = "800px"
				toggleBtn.querySelector("span").textContent = "Mostrar más"
				container.scrollIntoView({ behavior: "smooth", block: "center" })
				chevronUp.forEach(chevron => chevron.classList.add("hidden"))
				chevronDown.forEach(chevron => chevron.classList.remove("hidden"))
			}
		})
	})
</script>
